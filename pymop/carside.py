import numpy as np

from pymop.problem import Problem


class Carside(Problem):
    def __init__(self, **kwargs):
        Problem.__init__(self, **kwargs)
        self.n_var = 7
        self.n_constr = 10
        self.n_obj = 3
        self.func = self.evaluate_
        self.xl = np.array([0.5, 0.45, 0.5, 0.5, 0.875, 0.4, 0.4])
        self.xu = np.array([1.5, 1.35, 1.5, 1.5, 2.625, 1.2, 1.2])

    def evaluate_(self, x, f, g):
        g[:,0] = 1.16 - 0.3717 * x[:,1] * x[:,3] - 0.0092928 * x[:,2]
        g[:,1] = 0.261 - 0.0159 * x[:,0] * x[:,1] - 0.188 * x[:,0] * 0.345 - 0.019 * x[:,1] * x[:,6] + 0.0144 * x[:,2] * x[:,4] + 0.08045 * x[:,5] * 0.192
        g[:,2] = 0.214 + 0.00817 * x[:,4] - 0.131 * x[:,0] * 0.345 - 0.0704 * x[:,0] * 0.192 + 0.03099 * x[:,1] * x[:,5] - 0.018 * x[:,1] * x[:,6] + 0.0208 * x[:,2] * 0.345 + 0.121 * x[:,2] * 0.192 - 0.00364 * x[:,4] * x[:,5] - 0.018 * x[:,1] ** 2
        g[:,3] = 0.74 - 0.61 * x[:,1] - 0.031296 * x[:,2] - 0.166 * x[:,6] * 0.192 + 0.227 * x[:,1] ** 2
        g[:,4] = 28.98 + 3.818 * x[:,2] - 4.2 * x[:,0] * x[:,1] + 6.63 * x[:,5] * 0.192 - 7.77 * x[:,6] * 0.345
        g[:,5] = 33.86 + 2.95 * x[:,2] - 5.057 * x[:,0] * x[:,1] - 11 * x[:,1] * 0.345 - 9.98 * x[:,6] * 0.345 + 22 * 0.345 * 0.192
        g[:,6] = 46.36 - 9.9 * x[:,1] - 12.9 * x[:,0] * 0.345
        g[:,7] = 4.72 - 0.5 * x[:,3] - 0.19 * x[:,1] * x[:,2]
        g[:,8] = 10.58 - 0.674 * x[:,0] * x[:,1] - 1.95 * x[:,1] * 0.345
        g[:,9] = 16.45 - 0.489 * x[:,2] * x[:,6] - 0.843 * x[:,4] * x[:,5]

        f[:,0] = 1.98 + 4.9 * x[:,0] + 6.67 * x[:,1] + 6.98 * x[:,2] + 4.01 * x[:,3] + 1.78 * x[:,4] + 0.00001 * x[:,5] + 2.73 * x[:,6]
        f[:,1] = g[:,7]
        f[:,2] = (g[:,8] + g[:,9]) / 2.0

        g[:,0] = - 1 + g[:,0] / 1.0
        g[:,1] = -1 + g[:,1] / 0.32
        g[:,2] = -1 + g[:,2] / 0.32
        g[:,3] = -1 + g[:,3] / 0.32
        g[:,4] = -1 + g[:,4] / 32.0
        g[:,5] = -1 + g[:,5] / 32.0
        g[:,6] = -1 + g[:,6] / 32.0
        g[:,7] = -1 + g[:,7] / 4.0
        g[:,8] = -1 + g[:,8] / 9.9
        g[:,9] = -1 + g[:,9] / 15.7
